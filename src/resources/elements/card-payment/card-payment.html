<template>
  <require from="./card-payment.css"></require>
  <section class="card-payment">
    <div class="card-payment__toggle" click.trigger="parent.paymentMethod = (parent.paymentMethod === 'cardpayment' ? null: 'cardpayment')">
      <i show.bind="parent.paymentMethod !== 'cardpayment'" class="icon ion-arrow-right-b"></i>
      <i show.bind="parent.paymentMethod === 'cardpayment'" class="icon ion-arrow-down-b"></i>
      <i class="icon ion-card"></i>
      Card Payment
    </div>
    <div class="card-payment__content ${parent.paymentMethod === 'cardpayment' ? 'card-payment__content--active': ''}">
      <div if.bind="cards.length && !state.addcard">
        <label>
          Pay using:
          <select value.bind="selectedCard">
            <option repeat.for="card of cards" model.bind="card.id">${card.brand} ending with ${card.last4}</option>
          </select>
        </label>
        <button disabled.bind="state.inflight" click.delegate="charge()">Pay $${amount | toCurrency}</button>
        <button if.bind="!state.addcard" click.delegate="state.addcard = true">Add Card</button>
      </div>
      <div class="card-payment__add" if.bind="state.addcard || !cards.length">
        <payment-form save.call="charge(token)" button-text="Pay" isDisabled.bind="state.inflight"></payment-form>
        <a href="#" if.bind="cards.length" click.delegate="state.addcard = false">Cancel</a>
      </div>
    </div>
  </section>
</template>
